# Бэкенд для сервиса домов

## Описание
В этом репозитории представлена реализация бэкенда для сервиса домой. Взаимодействие с сервисом происходит следующим образом:
1. Необходимо получить токен. Авторизация происходит двумя способами: получить токен через ендпоинт /dummyLogin или зарегистрироваться через ендпоинт /register, затем залогиниться через ендпоинт /login и получить токен.
2. Модератор может создавать дома и модерировать квартиры.
3. Пользователь может создавать квартиры, получать все квартиры, прошедшие модерацию, подписаться на уведомление о новых квартирах в доме.

## Решение
Сервис написан на Golang с использованием фреймворка gin. 

Для взаимодействия с базой данных используется библиотеки pgx, squirrel, migrate.

Для быстрого ответа на запрос получения квартир в доме используется кеш из библиотеки golang-lru. 

Для генерации и проверки токенов используется библиотека golang-jwt . Для хранения данных используется PostgreSQL, в котором созданы таблицы для пользователей, квартир, домов и людей, которые подписались на обновления дома, а также индекс для эффективного поиска данных.

## Вопросы и проблемы
1.  При создании квартиры поле rooms не установлено как required, 
но при этом при получении квартир поле rooms является required с указанием >= 1. 
Я принял решение инициализировать поле rooms = 1 при его отсутствии в запросе 
2.  При обновлении статуса квартиры модератором поле status 
не установлено как required, и неизвестно на что его менять. 
Я принял решение обозначить такую логику: при передаче только id квартиры, 
будем считать что эту квартиру берут на модерацию и ее статус меняется на on_moderation

## Сборка и Деплой
Все необходимые операции осуществляются с помощью Makefile и Docker.

Чтобы запустить сервис, выполните:
```make up```

Чтобы остановить сервис, выполните:
```make down```

## Тесты
Чтобы запустить юнит тесты выполните:
```make unit```

Для того, чтобы запустились интеграционные тесты, сервис должен быть запущен

Чтобы запустить все тесты выполните:
```make test```